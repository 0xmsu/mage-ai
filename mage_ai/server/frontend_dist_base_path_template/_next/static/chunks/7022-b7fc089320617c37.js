"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7022],{17022:function(e,n,r){var s=r(75582),i=r(82394),l=r(21764),t=r(82684),c=r(83455),u=r(34376),o=r(71180),d=r(70652),a=r(15338),m=r(97618),j=r(55485),f=r(85854),p=r(65956),x=r(28274),h=r(38276),Z=r(75499),g=r(30160),v=r(17488),b=r(5332),P=r(8193),y=r(72473),I=r(70515),k=r(24755),O=r(3917),S=r(76417),C=r(36717),M=r(86735),w=r(42122),_=r(72619),N=r(95924),T=r(28598);function E(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,s)}return r}function R(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?E(Object(r),!0).forEach((function(n){(0,i.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var A,H=2*I.iI;!function(e){e.PERMISSIONS="Permissions",e.USERS="Users"}(A||(A={})),n.Z=function(e){var n,r=e.contained,i=e.onCancel,E=e.slug,D=(0,u.useRouter)(),F=(0,t.useState)(!0),U=F[0],B=F[1],G=(0,t.useState)(null),L=G[0],q=G[1],z=(0,t.useState)({}),K=z[0],W=z[1],Y=(0,t.useState)(null),$=Y[0],V=Y[1],J=(0,t.useCallback)((function(e,n,r){V(R(R({},e),{},{permissionsMapping:(0,M.HK)(n||[],(function(e){return e.id})),usersMapping:(0,M.HK)(r||[],(function(e){return e.id}))}))}),[V]),Q=(0,t.useCallback)((function(e){W((function(n){return R(R({},n),e)})),V((function(n){return R(R({},n),e)}))}),[W,V]),X=b.ZP.roles.detail(E,{},{revalidateOnFocus:!1}).data,ee=(0,t.useMemo)((function(){return null==X?void 0:X.role}),[X]);(0,t.useEffect)((function(){ee&&J(ee,null==ee?void 0:ee.role_permissions,null==ee?void 0:ee.users)}),[J,ee]);var ne=(0,c.Db)(ee?b.ZP.roles.useUpdate(null==ee?void 0:ee.id):b.ZP.roles.useCreate(),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(e){var n=e.role;W({}),J(n,null==n?void 0:n.role_permissions,null==n?void 0:n.users),ee||D.push("/settings/workspace/roles/".concat(null==n?void 0:n.id)),l.Am.success(ee?"Role successfully updated.":"New role created successfully.",{position:l.Am.POSITION.BOTTOM_RIGHT,toastId:"role-mutate-success-".concat(n.id)})},onErrorCallback:function(e){var n=e.error,r=n.errors,s=n.exception,i=n.message,t=n.type;l.Am.error((null==r?void 0:r.error)||s||i,{position:l.Am.POSITION.BOTTOM_RIGHT,toastId:t})}})}}),re=(0,s.Z)(ne,2),se=re[0],ie=re[1].isLoading,le=(0,c.Db)(b.ZP.roles.useDelete(null==ee?void 0:ee.id),{onSuccess:function(e){return(0,_.wD)(e,{callback:function(){D.push("/settings/workspace/roles"),l.Am.success("Role successfully delete.",{position:l.Am.POSITION.BOTTOM_RIGHT,toastId:"role-delete-success-".concat(null==ee?void 0:ee.id)})},onErrorCallback:function(e){var n=e.error,r=n.errors,s=n.exception,i=n.message,t=n.type;l.Am.error((null==r?void 0:r.error)||s||i,{position:l.Am.POSITION.BOTTOM_RIGHT,toastId:t})}})}}),te=(0,s.Z)(le,2),ce=te[0],ue=te[1].isLoading,oe=b.ZP.permissions.list({_limit:1e3},{},{pauseFetch:!ee}).data,de=(0,t.useMemo)((function(){return(0,M.YC)((null==oe?void 0:oe.permissions)||[],"entity_name")}),[oe]),ae=(0,t.useMemo)((function(){return(null==$?void 0:$.permissionsMapping)||{}}),[$]),me=(0,t.useMemo)((function(){return(0,M.YC)(Object.values(ae),"entity_name")}),[ae]),je=b.ZP.users.list({},{},{pauseFetch:!ee}).data,fe=(0,t.useMemo)((function(){return(0,M.YC)((null==je?void 0:je.users)||[],(function(e){return(0,S.s)(e)}))}),[je]),pe=(0,t.useMemo)((function(){return(null==$?void 0:$.usersMapping)||{}}),[$]),xe=(0,t.useMemo)((function(){return(0,M.YC)(Object.values(pe),(function(e){return(0,S.s)(e)}))}),[pe]),he=(0,t.useMemo)((function(){return(null==me?void 0:me.length)>=1}),[me]),Ze=(0,t.useMemo)((function(){return(0,T.jsx)(o.ZP,{beforeIcon:(0,T.jsx)(y.Add,{}),compact:!0,onClick:function(){q(A.PERMISSIONS),B(!1)},primary:!he,secondary:he,small:!0,children:"Add permission"})}),[he,q,B]),ge=(0,t.useMemo)((function(){return(null==xe?void 0:xe.length)>=1}),[xe]),ve=(0,t.useMemo)((function(){return(0,T.jsx)(o.ZP,{beforeIcon:(0,T.jsx)(y.Add,{}),compact:!0,onClick:function(){q(A.USERS),B(!1)},primary:!ge,secondary:ge,small:!0,children:"Add user"})}),[ge]),be=(0,t.useCallback)((function(e,n){return(0,T.jsx)(Z.Z,{columnFlex:[null,null,2,1,1,6],columns:[{label:function(){var n=null==e?void 0:e.every((function(e){var n=e.id;return null==ae?void 0:ae[n]}));return(0,T.jsx)(d.Z,{checked:n,onClick:function(r){(0,N.j)(r),Q(n?{permissionsMapping:{}}:{permissionsMapping:(0,M.HK)(e,(function(e){return e.id}))})}},"checkbox")},uuid:"actions"},{uuid:"ID"},{uuid:"Entity"},{uuid:"Subtype"},{uuid:"Entity ID"},{rightAligned:!0,uuid:"Access"}],onClickRow:n?function(n){var r=e[n];r&&window.open("/settings/workspace/permissions/".concat(null==r?void 0:r.id),"_blank").focus()}:null,rows:null==e?void 0:e.map((function(e){var n=e.access,r=e.entity,s=e.entity_id,i=e.entity_name,l=e.entity_type,t=e.id,c=n?(0,C.q)(n):[],u=(null==c?void 0:c.length)||0,o=!(null==ae||!ae[t]);return[(0,T.jsx)(d.Z,{checked:o,onClick:function(n){(0,N.j)(n);var r=R({},ae);o?null==r||delete r[t]:r[t]=e,Q({permissionsMapping:r})}},"checkbox"),(0,T.jsx)(g.ZP,{default:!0,monospace:!0,children:t},"id"),(0,T.jsx)(g.ZP,{monospace:!0,children:i||r},"entityName"),(0,T.jsx)(g.ZP,{default:!0,monospace:!!l,children:l||"-"},"entityType"),(0,T.jsx)(g.ZP,{default:!0,monospace:!!s,children:s||"-"},"entityID"),(0,T.jsx)("div",{children:u>=1&&(0,T.jsx)(j.ZP,{alignItems:"center",flexWrap:"wrap",justifyContent:"flex-end",children:null==c?void 0:c.map((function(e,n){return(0,T.jsx)("div",{children:(0,T.jsxs)(g.ZP,{default:!0,monospace:!0,small:!0,children:[e,u>=2&&n<u-1&&(0,T.jsx)(g.ZP,{inline:!0,muted:!0,small:!0,children:",Â "})]})},e)}))})},"access")]})),uuid:"permissions"})}),[ae,Q]),Pe=(0,t.useCallback)((function(e,n){return(0,T.jsx)(Z.Z,{columnFlex:[null,1,1,1],columns:[{label:function(){var n=null==e?void 0:e.every((function(e){var n=e.id;return null==pe?void 0:pe[n]}));return(0,T.jsx)(d.Z,{checked:n,onClick:function(r){(0,N.j)(r),Q(n?{usersMapping:{}}:{usersMapping:(0,M.HK)(e,(function(e){return e.id}))})}},"checkbox")},uuid:"actions"},{uuid:"Username"},{uuid:"First name"},{uuid:"Last name"}],onClickRow:n?function(n){var r=e[n];r&&window.open("/settings/workspace/users/".concat(null==r?void 0:r.id),"_blank").focus()}:null,rows:null==e?void 0:e.map((function(e){var n=e.first_name,r=e.id,s=e.last_name,i=e.username,l=!(null==pe||!pe[r]);return[(0,T.jsx)(d.Z,{checked:l,onClick:function(n){(0,N.j)(n);var s=R({},pe);l?null==s||delete s[r]:s[r]=e,Q({usersMapping:s})}},"checkbox"),(0,T.jsx)(g.ZP,{children:i},"username"),(0,T.jsx)(g.ZP,{default:!0,children:n},"firstName"),(0,T.jsx)(g.ZP,{default:!0,children:s},"lastName")]})),uuid:"users"})}),[pe,Q]),ye=(0,t.useMemo)((function(){return be(de)}),[be,de]),Ie=(0,t.useMemo)((function(){return Pe(fe)}),[Pe,fe]),ke=(0,t.useMemo)((function(){return be(me,!0)}),[be,me]),Oe=(0,t.useMemo)((function(){return Pe(xe,!0)}),[Pe,xe]),Se=(0,T.jsxs)(P.N,{children:[(0,T.jsxs)(p.Z,{noPadding:!0,children:[(0,T.jsx)(h.Z,{p:I.cd,children:(0,T.jsx)(f.Z,{level:4,children:"Role"})}),(0,T.jsx)(a.Z,{light:!0}),(0,T.jsx)(h.Z,{p:I.cd,children:(0,T.jsxs)(j.ZP,{alignItems:"center",children:[(0,T.jsxs)(g.ZP,{danger:"name"in K&&!(null!=$&&$.name),default:!0,large:!0,children:["Name ","name"in K&&!(null!=$&&$.name)&&(0,T.jsx)(g.ZP,{danger:!0,inline:!0,large:!0,children:"is required"})]}),(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsx)(m.Z,{flex:1,children:(0,T.jsx)(v.Z,{afterIcon:(0,T.jsx)(y.Edit,{}),afterIconClick:function(e,n){var r;null==n||null===(r=n.current)||void 0===r||r.focus()},afterIconSize:H,alignRight:!0,autoComplete:"off",large:!0,noBackground:!0,noBorder:!0,fullWidth:!0,onChange:function(e){return Q({name:e.target.value})},paddingHorizontal:0,paddingVertical:0,placeholder:"e.g. Archmage",value:(null==$?void 0:$.name)||""})})]})})]}),(0,T.jsx)(h.Z,{mb:I.HN}),ee&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(p.Z,{noPadding:!0,children:[(0,T.jsx)(h.Z,{p:I.cd,children:(0,T.jsxs)(j.ZP,{alignItems:"center",justifyContent:"space-between",children:[(0,T.jsx)(f.Z,{level:4,children:"Permissions"}),(0,T.jsx)(h.Z,{mr:I.cd}),he&&(0,T.jsx)(j.ZP,{alignItems:"center",children:Ze})]})}),(0,T.jsx)(a.Z,{light:!0}),!he&&(0,T.jsxs)(h.Z,{p:I.cd,children:[(0,T.jsx)(h.Z,{mb:I.cd,children:(0,T.jsx)(g.ZP,{default:!0,children:"This role currently has no permissions attached."})}),(0,T.jsx)(j.ZP,{alignItems:"center",children:Ze})]}),he&&(0,T.jsx)(h.Z,{pb:I.Mq,children:ke})]}),(0,T.jsx)(h.Z,{mb:I.HN}),(0,T.jsxs)(p.Z,{noPadding:!0,children:[(0,T.jsx)(h.Z,{p:I.cd,children:(0,T.jsxs)(j.ZP,{alignItems:"center",justifyContent:"space-between",children:[(0,T.jsx)(f.Z,{level:4,children:"Users"}),(0,T.jsx)(h.Z,{mr:I.cd}),ge&&(0,T.jsx)(j.ZP,{alignItems:"center",children:ve})]})}),(0,T.jsx)(a.Z,{light:!0}),!ge&&(0,T.jsxs)(h.Z,{p:I.cd,children:[(0,T.jsx)(h.Z,{mb:I.cd,children:(0,T.jsx)(g.ZP,{default:!0,children:"There are currently no users with this role."})}),(0,T.jsx)(j.ZP,{alignItems:"center",children:ve})]}),ge&&(0,T.jsx)(h.Z,{pb:I.Mq,children:Oe})]}),(0,T.jsx)(h.Z,{mb:I.HN}),(0,T.jsxs)(p.Z,{noPadding:!0,children:[(0,T.jsx)(h.Z,{p:I.cd,children:(0,T.jsx)(f.Z,{level:4,children:"Metadata"})}),(0,T.jsx)(a.Z,{light:!0}),(0,T.jsx)(h.Z,{p:I.cd,children:(0,T.jsxs)(j.ZP,{alignItems:"center",children:[(0,T.jsx)(g.ZP,{default:!0,large:!0,children:"Last updated"}),(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsxs)(m.Z,{alignItems:"center",flex:1,justifyContent:"flex-end",children:[(0,T.jsx)(g.ZP,{large:!0,monospace:!0,muted:!0,children:(null==$?void 0:$.updated_at)&&(0,O.d$)(null==$?void 0:$.updated_at,{includeSeconds:!0})}),(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsx)(y.Schedule,{muted:!0,size:H}),(0,T.jsx)(h.Z,{mr:1})]})]})}),(0,T.jsx)(a.Z,{light:!0}),(0,T.jsx)(h.Z,{p:I.cd,children:(0,T.jsxs)(j.ZP,{alignItems:"center",children:[(0,T.jsx)(g.ZP,{default:!0,large:!0,children:"Created at"}),(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsxs)(m.Z,{alignItems:"center",flex:1,justifyContent:"flex-end",children:[(0,T.jsx)(g.ZP,{large:!0,monospace:!0,muted:!0,children:(null==$?void 0:$.created_at)&&(0,O.d$)(null==$?void 0:$.created_at,{includeSeconds:!0})}),(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsx)(y.Schedule,{muted:!0,size:H}),(0,T.jsx)(h.Z,{mr:1})]})]})}),(0,T.jsx)(a.Z,{light:!0}),(0,T.jsx)(h.Z,{p:I.cd,children:(0,T.jsxs)(j.ZP,{alignItems:"center",children:[(0,T.jsx)(g.ZP,{default:!0,large:!0,children:"Created by"}),(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsxs)(m.Z,{alignItems:"center",flex:1,justifyContent:"flex-end",children:[(0,T.jsx)(g.ZP,{large:!0,monospace:!0,muted:!0,children:(0,S.s)(null==ee?void 0:ee.user)}),(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsx)(y.UserSmileyFace,{muted:!0,size:H}),(0,T.jsx)(h.Z,{mr:1})]})]})})]}),(0,T.jsx)(h.Z,{mb:I.HN})]}),(0,T.jsxs)(j.ZP,{children:[(0,T.jsx)(o.ZP,{beforeIcon:(0,T.jsx)(y.Save,{}),disabled:!K||!(null!==(n=Object.keys(K))&&void 0!==n&&n.length),loading:ie,onClick:function(){return se({role:R(R({},(0,w.GL)($,["name"],{include_blanks:!0})),{},{permission_ids:Object.keys((null==$?void 0:$.permissionsMapping)||{}).map((function(e){return Number(e)})),user_ids:Object.keys((null==$?void 0:$.usersMapping)||{}).map((function(e){return Number(e)}))})})},primary:!0,children:ee?"Save changes":"Create new role"}),i&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsx)(o.ZP,{onClick:function(){return null==i?void 0:i()},secondary:!0,children:"Cancel and go back"})]}),ee&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(h.Z,{mr:I.cd}),(0,T.jsx)(o.ZP,{beforeIcon:(0,T.jsx)(y.Trash,{}),danger:!0,loading:ue,onClick:function(){return ce()},children:"Delete role"})]})]})]});return r?Se:(0,T.jsx)(x.Z,{after:A.PERMISSIONS===L?ye:A.USERS===L?Ie:null,afterHeader:(0,T.jsx)(h.Z,{px:I.cd,children:(0,T.jsx)(g.ZP,{bold:!0,children:L})}),afterHidden:U,afterWidth:60*I.iI,appendBreadcrumbs:!0,breadcrumbs:[{label:function(){return"Roles"},linkProps:{href:"/settings/workspace/roles"}},{bold:!0,label:function(){return null==ee?void 0:ee.name}}],hideAfterCompletely:!0,setAfterHidden:B,title:null!=ee&&ee.name?"".concat(null==ee?void 0:ee.name," role"):"New role",uuidItemSelected:k.B2.ROLES,uuidWorkspaceSelected:k.Pl.USER_MANAGEMENT,children:ee&&Se})}},36717:function(e,n,r){r.d(n,{q:function(){return l}});var s=r(75582),i=r(36288);function l(e){return Object.entries(i.K4).reduce((function(n,r){var i=(0,s.Z)(r,2),l=i[0],t=i[1];return e&Number(l)?n.concat(t):n}),[])}}}]);