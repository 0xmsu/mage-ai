(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5378],{16488:function(n,e,t){"use strict";t.d(e,{IJ:function(){return m},M8:function(){return x},Uc:function(){return S},XM:function(){return C},_U:function(){return p},eI:function(){return E},gU:function(){return _},lO:function(){return I},ri:function(){return h},tL:function(){return T},vJ:function(){return b},xH:function(){return O}});var r,o=t(82394),u=t(92083),i=t.n(u),c=t(3917),l=t(4383),s=t(30229),a=t(42122),d=t(86735);function v(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function f(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?v(Object(t),!0).forEach((function(e){(0,o.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var p=function(n){return!!n&&!Object.values(s.U5).includes(n)};function m(n){return null===n||void 0===n?void 0:n.reduce((function(n,e){var t=e.block_uuid,r=e.completed_at,u=e.started_at,c=e.status,l=null;u&&r&&(l=i()(r).valueOf()-i()(u).valueOf());return f(f({},n),{},(0,o.Z)({},t,{runtime:l,status:c}))}),{})}var g,h=function(n){var e=[{description:function(){return"This pipeline will run continuously on an interval or just once."},label:function(){return"Schedule"},uuid:s.Xm.TIME},{description:function(){return"This pipeline will run when a specific event occurs."},label:function(){return"Event"},uuid:s.Xm.EVENT},{description:function(){return"Run this pipeline when you make an API call."},label:function(){return"API"},uuid:s.Xm.API}];return n?e.slice(0,1):e};function O(n){var e=(0,a.gR)(n,[s.gm.INTERVAL,s.gm.TYPE]),t=n[s.gm.INTERVAL];t&&(e["schedule_interval[]"]=encodeURIComponent(t));var r=n[s.gm.TYPE];return r&&(e["schedule_type[]"]=r),e}function E(n){return n?new Date(i()(n).valueOf()):null}function N(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"!==typeof n)return n;var t=n.split("+")[0],r=i()(E(t)),o=r.format(e||c.Nx);return o}function S(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e?(0,c.XG)(n,e,t):N(n,t)}!function(n){n.DAY="day",n.HOUR="hour",n.MINUTE="minute",n.SECOND="second"}(g||(g={}));var T=(r={},(0,o.Z)(r,g.DAY,86400),(0,o.Z)(r,g.HOUR,3600),(0,o.Z)(r,g.MINUTE,60),(0,o.Z)(r,g.SECOND,1),r);function _(n){var e=g.SECOND,t=n;return n%86400===0?(t/=86400,e=g.DAY):n%3600===0?(t/=3600,e=g.HOUR):n%60===0&&(t/=60,e=g.MINUTE),{time:t,unit:e}}function b(n,e){return n*T[e]}function C(n,e,t){var r,o=i()(n);return o.set("hour",+(null===e||void 0===e?void 0:e.hour)||0),o.set("minute",+(null===e||void 0===e?void 0:e.minute)||0),o.set("second",0),r=o.format(c.TD),null!==t&&void 0!==t&&t.includeSeconds&&(r=r.concat(":00")),null!==t&&void 0!==t&&t.localTimezone&&(r=o.format(c.lE),null!==t&&void 0!==t&&t.convertToUtc&&(r=(0,c.d$)(r,{includeSeconds:null===t||void 0===t?void 0:t.includeSeconds,utcFormat:!0}))),r}function x(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="",r=!0;if(r){var o=(0,l.XF)();e?t="".concat(o,"/api/pipeline_schedules/").concat(null===n||void 0===n?void 0:n.id,"/api_trigger"):(t="".concat(o,"/api/pipeline_schedules/").concat(null===n||void 0===n?void 0:n.id,"/pipeline_runs"),null!==n&&void 0!==n&&n.token&&(t="".concat(t,"/").concat(n.token)))}return t}function j(n,e,t){return n.match(/[*,-/]/)?{additionalOffset:0,cronValue:n}:function(n,e,t){var r=t.indexOf(n),o=0;if(e<0)for(var u=0;u>e;u--)0===r?(r=t.length-1,o-=1):r-=1;else if(e>0)for(var i=0;i<e;i++)r===t.length-1?(r=0,o+=1):r+=1;var c="number"===typeof t[r]?t[r]:n;return{additionalOffset:o,cronValue:String(c)}}(+n,e,t)}var P=(0,d.m5)(60),Z=(0,d.m5)(24),w=(0,c.Cs)();function I(n,e){if(!n)return n;var t=i()().local().format("Z"),r=t.split(":"),o="-"===t[0],u=3===r[0].length?Number(r[0].slice(1)):Number(r[0]),c=Number(r[1]);(o&&!e||!o&&e)&&(u=-u,c=-c);var l=n.split(" "),s=l[0],a=l[1],d=l[2],v=j(s,c,P),f=j(a,u+v.additionalOffset,Z);if(l[0]=v.cronValue,l[1]=f.cronValue,0!==(null===f||void 0===f?void 0:f.additionalOffset)){var p=j(d,f.additionalOffset,w);l[2]=p.cronValue}return l.join(" ")}},51697:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return M}});var r,o,u,i,c,l=t(77837),s=t(38860),a=t.n(s),d=t(89565),v=t.n(d),f=t(82684),p=t(38276),m=t(55485),g=t(97618),h=t(2367),O=t(21831),E=t(75582),N=t(69864),S=t(35686);!function(n){n[n.CONNECTING=0]="CONNECTING",n[n.OPEN=1]="OPEN",n[n.CLOSED=2]="CLOSED"}(r||(r={})),function(n){n.DATA="data",n.STDOUT="stdout"}(o||(o={})),function(n){n.EXECUTION="execution",n.EXECUTION_STATUS="execution_status",n.TASK="task",n.TASK_STATUS="task_status"}(u||(u={})),function(n){n.ERROR="error",n.FAILURE="failure",n.RUNNING="running",n.SUCCESS="success"}(i||(i={})),function(n){n.CLOSED="closed",n.CONNECTING="connecting",n.OPEN="open",n.RECONNECTING="reconnecting"}(c||(c={}));var T=t(4383),_=t(72619),b=t(87432),C=t(81728);var x=t(3917),j=t(92083),P=t.n(j),Z=t(35576),w=t(16488),I=t(70320),y=t(71180),D=t(30160),U=t(28598);function R(n){var e=n.error,t=(0,h.Z)({response:{error:e},stackTraceVisible:!0,tracebackVisible:!0}),r=t.displayMessage,o=t.exception,u=t.links,i=t.stackTrace,c=t.traceback;return(0,U.jsxs)("div",{children:[(0,U.jsx)(D.ZP,{bold:!0,large:!0,children:"Error"}),r&&(0,U.jsx)(p.Z,{mt:1,children:r}),o&&(0,U.jsx)(p.Z,{mt:1,children:o}),c&&(0,U.jsx)(p.Z,{mt:2,children:c}),i&&(0,U.jsx)(p.Z,{mt:2,children:i}),u]})}function k(n){var e=n.uuid,t=(0,I.qB)(),u=(0,f.useState)(""),i=u[0],l=u[1],s=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{autoReconnect:!0,maxConnectionAttempts:10},t=e.autoReconnect,o=e.maxConnectionAttempts,u=(0,f.useRef)(o),i=(0,f.useRef)(null),l=(0,f.useRef)(null),s=(0,f.useState)([]),a=s[0],d=s[1],v=(0,f.useState)([]),p=v[0],m=v[1],g=(0,f.useState)([]),h=g[0],x=g[1],j=(0,f.useState)(c.CONNECTING),P=j[0],Z=j[1],w=(0,N.Db)((function(e){return m((function(n){return[].concat((0,O.Z)(n),[null])})),S.ZP.code_executions.useCreate()({code_execution:{message:null===e||void 0===e?void 0:e.message,message_request_uuid:(0,C.Mp)(),timestamp:Number(new Date),uuid:n}})}),{onSuccess:function(n){return(0,_.wD)(n,{callback:function(n){(0,b.L1)()&&console.log("useEventStreams.createMessage",n),null!==n&&void 0!==n&&n.server_sent_event&&x((function(e){return[].concat((0,O.Z)(e),[null===n||void 0===n?void 0:n.server_sent_event])}))},onErrorCallback:function(n){d((function(e){return[].concat((0,O.Z)(e),[n])}))}})}}),I=(0,E.Z)(w,2),y=I[0],D=I[1].isLoading;function U(){var n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||(null===i||void 0===i?void 0:i.current);n&&(null===n||void 0===n||n.close()),null!==i&&void 0!==i&&i.current&&(i.current=null),Z(c.CLOSED)}function R(n,e){if(e<=0)console.log("Max reconnection attempts reached. Stopping reconnection.");else{var o=e;null!==i&&void 0!==i&&i.current&&(r.OPEN===(null===i||void 0===i?void 0:i.current.readyState)?(Z(c.OPEN),o=null===u||void 0===u?void 0:u.current,clearTimeout(null===l||void 0===l?void 0:l.current)):U());var s=null===i||void 0===i?void 0:i.current;s||(console.log("Connecting to server..."),i.current=new EventSource((0,T.if)(n)),(s=null===i||void 0===i?void 0:i.current)&&(s.onopen=function(n){(0,b.L1)()&&console.log("useEventStreams.onopen",s,n),Z(c.OPEN)},s.onmessage=function(e){(0,b.L1)()&&console.log("useEventStreams.onmessage",e);var t=JSON.parse(e.data);t.uuid===n&&m((function(n){return[].concat((0,O.Z)(n),[t])}))},s.onerror=function(e){console.error("EventSource failed with error: ",e),d((function(n){return[].concat((0,O.Z)(n),[e])})),U(),t&&(Z(c.RECONNECTING),clearTimeout(null===l||void 0===l?void 0:l.current),l.current=setTimeout((function(){console.log("Reconnecting to server witth ".concat(o," attempt(s) remaining...")),R(n,o-1)}),1e3*(Math.max(0,(null===u||void 0===u?void 0:u.current)-o)+1)))}))}}return(0,f.useEffect)((function(){R(n,1+(t&&(null===u||void 0===u?void 0:u.current)||0));var e=null===i||void 0===i?void 0:i.current;return function(){U(e)}}),[t,n]),{errors:a,events:p,loading:D,messages:h,recentEvent:null===p||void 0===p?void 0:p[(null===p||void 0===p?void 0:p.length)-1],sendMessage:y,status:P}}(e),a=s.errors,d=s.events,p=s.loading,h=s.sendMessage,j=s.status;null!==a&&void 0!==a&&a.length&&console.log(a);var k=(0,f.useMemo)((function(){var n,e;return null===d||void 0===d||null===(n=d[(null===d||void 0===d?void 0:d.length)-1])||void 0===n||null===(e=n.result)||void 0===e?void 0:e.error}),[d]),M=(0,f.useMemo)((function(){return null===d||void 0===d?void 0:d.filter((function(n){return!!n}))}),[d]),A=(0,f.useMemo)((function(){var n;return(null===M||void 0===M||null===(n=M.filter((function(n){var e;return(null===n||void 0===n||null===(e=n.result)||void 0===e?void 0:e.type)===o.STDOUT})))||void 0===n?void 0:n.length)||0}),[M]);return console.log(d),(0,U.jsxs)("div",{children:[k&&(0,U.jsx)(R,{error:k}),null===M||void 0===M?void 0:M.map((function(n,e){if(!n)return null;var r=n.event_uuid,o=n.result,u=n.timestamp,i=o||{output:null,output_text:null},c=(i.output,i.output_text),l=(0,C.NE)("",String(A).length-String(e).length,"&nbsp;")+"[".concat(e,"]");return(0,U.jsx)("div",{children:(0,U.jsxs)(m.ZP,{alignItems:"flex-start",fullWidth:!0,justifyContent:"space-between",children:[(0,U.jsx)(g.Z,{children:(0,U.jsxs)(D.ZP,{monospace:!0,preWrap:!0,children:[(0,U.jsx)(D.ZP,{default:!0,inline:!0,monospace:!0,children:(0,U.jsx)("span",{dangerouslySetInnerHTML:{__html:l}})})," ",(0,U.jsx)(v(),{children:c})]})}),(0,U.jsx)(D.ZP,{monospace:!0,muted:!0,children:(0,w.Uc)(P()(u).format(x.BL),t,x.BL)})]})},r)})),(0,U.jsx)(Z.Z,{autoGrow:!0,label:"Message",monospace:!0,name:"message",onChange:function(n){return l(n.target.value)},rows:12}),(0,U.jsxs)(y.ZP,{loading:p,onClick:function(){return h({message:i})},children:["Send Message (",j,")"]})]})}k.getInitialProps=function(){var n=(0,l.Z)(a().mark((function n(e){var t;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.query.uuid,n.abrupt("return",{uuid:t});case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();var M=k},91185:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test",function(){return t(51697)}])}},function(n){n.O(0,[9774,2888,179],(function(){return e=91185,n(n.s=e);var e}));var e=n.O();_N_E=e}]);