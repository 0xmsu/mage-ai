(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1890],{70815:function(t,e,n){"use strict";var r=n(554);function o(t){return"object"!=typeof t||"toString"in t?t:Object.prototype.toString.call(t).slice(8,-1)}Object.defineProperty(e,"__esModule",{value:!0});var i="object"==typeof r&&!0;function u(t,e){if(!t){if(i)throw new Error("Invariant failed");throw new Error(e())}}e.invariant=u;var c=Object.prototype.hasOwnProperty,l=Array.prototype.splice,a=Object.prototype.toString;function s(t){return a.call(t).slice(8,-1)}var f=Object.assign||function(t,e){return d(e).forEach((function(n){c.call(e,n)&&(t[n]=e[n])})),t},d="function"==typeof Object.getOwnPropertySymbols?function(t){return Object.keys(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.keys(t)};function p(t){return Array.isArray(t)?f(t.constructor(t.length),t):"Map"===s(t)?new Map(t):"Set"===s(t)?new Set(t):t&&"object"==typeof t?f(Object.create(Object.getPrototypeOf(t)),t):t}var v=function(){function t(){this.commands=f({},g),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(t,e){return t===e},this.update.newContext=function(){return(new t).update}}return Object.defineProperty(t.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(t){this.update.isEquals=t},enumerable:!0,configurable:!0}),t.prototype.extend=function(t,e){this.commands[t]=e},t.prototype.update=function(t,e){var n=this,r="function"==typeof e?{$apply:e}:e;Array.isArray(t)&&Array.isArray(r)||u(!Array.isArray(r),(function(){return"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."})),u("object"==typeof r&&null!==r,(function(){return"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the following commands: "+Object.keys(n.commands).join(", ")+"."}));var o=t;return d(r).forEach((function(e){if(c.call(n.commands,e)){var i=t===o;o=n.commands[e](r[e],o,r,t),i&&n.isEquals(o,t)&&(o=t)}else{var u="Map"===s(t)?n.update(t.get(e),r[e]):n.update(t[e],r[e]),l="Map"===s(o)?o.get(e):o[e];n.isEquals(u,l)&&(void 0!==u||c.call(t,e))||(o===t&&(o=p(t)),"Map"===s(o)?o.set(e,u):o[e]=u)}})),o},t}();e.Context=v;var g={$push:function(t,e,n){return h(e,n,"$push"),t.length?e.concat(t):e},$unshift:function(t,e,n){return h(e,n,"$unshift"),t.length?t.concat(e):e},$splice:function(t,e,n,r){return function(t,e){u(Array.isArray(t),(function(){return"Expected $splice target to be an array; got "+o(t)})),b(e.$splice)}(e,n),t.forEach((function(t){b(t),e===r&&t.length&&(e=p(r)),l.apply(e,t)})),e},$set:function(t,e,n){return function(t){u(1===Object.keys(t).length,(function(){return"Cannot have more than one key in an object with $set"}))}(n),t},$toggle:function(t,e){y(t,"$toggle");var n=t.length?p(e):e;return t.forEach((function(t){n[t]=!e[t]})),n},$unset:function(t,e,n,r){return y(t,"$unset"),t.forEach((function(t){Object.hasOwnProperty.call(e,t)&&(e===r&&(e=p(r)),delete e[t])})),e},$add:function(t,e,n,r){return O(e,"$add"),y(t,"$add"),"Map"===s(e)?t.forEach((function(t){var n=t[0],o=t[1];e===r&&e.get(n)!==o&&(e=p(r)),e.set(n,o)})):t.forEach((function(t){e!==r||e.has(t)||(e=p(r)),e.add(t)})),e},$remove:function(t,e,n,r){return O(e,"$remove"),y(t,"$remove"),t.forEach((function(t){e===r&&e.has(t)&&(e=p(r)),e.delete(t)})),e},$merge:function(t,e,n,r){var i,c;return i=e,u((c=t)&&"object"==typeof c,(function(){return"update(): $merge expects a spec of type 'object'; got "+o(c)})),u(i&&"object"==typeof i,(function(){return"update(): $merge expects a target of type 'object'; got "+o(i)})),d(t).forEach((function(n){t[n]!==e[n]&&(e===r&&(e=p(r)),e[n]=t[n])})),e},$apply:function(t,e){var n;return u("function"==typeof(n=t),(function(){return"update(): expected spec of $apply to be a function; got "+o(n)+"."})),t(e)}},m=new v;function h(t,e,n){u(Array.isArray(t),(function(){return"update(): expected target of "+o(n)+" to be an array; got "+o(t)+"."})),y(e[n],n)}function y(t,e){u(Array.isArray(t),(function(){return"update(): expected spec of "+o(e)+" to be an array; got "+o(t)+". Did you forget to wrap your parameter in an array?"}))}function b(t){u(Array.isArray(t),(function(){return"update(): expected spec of $splice to be an array of arrays; got "+o(t)+". Did you forget to wrap your parameters in an array?"}))}function O(t,e){var n=s(t);u("Map"===n||"Set"===n,(function(){return"update(): "+o(e)+" expects a target of type Set or Map; got "+o(n)}))}e.isEquals=m.update.isEquals,e.extend=m.extend,e.default=m.update,e.default.default=t.exports=f(e.default,e)},554:function(t){var e,n,r=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function u(t){if(e===setTimeout)return setTimeout(t,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:o}catch(t){e=o}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(t){n=i}}();var c,l=[],a=!1,s=-1;function f(){a&&c&&(a=!1,c.length?l=c.concat(l):s=-1,l.length&&d())}function d(){if(!a){var t=u(f);a=!0;for(var e=l.length;e;){for(c=l,l=[];++s<e;)c&&c[s].run();s=-1,e=l.length}c=null,a=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{return n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new p(t,e)),1!==l.length||a||u(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=v,r.addListener=v,r.once=v,r.off=v,r.removeListener=v,r.removeAllListeners=v,r.emit=v,r.prependListener=v,r.prependOnceListener=v,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},31890:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return ft}});var r,o,i,u,c,l,a=n(26304),s=n(75582),f=n(82394),d=n(70815),p=n.n(d),v=n(82684),g=n(14567),m=n(65701),h=n(1254),y=n(91560),b=n.n(y),O=(0,n(99713).D)(b(),{classNames:["canvas"]});!function(t){t.DRAGGABLE="draggable",t.DROPPABLE="droppable",t.PANNABLE="pannable",t.SCROLLABLE="scrollable",t.ZOOMABLE="zoomable"}(r||(r={})),function(t){t.HORIZONTAL="horizontal",t.VERTICAL="vertical"}(o||(o={})),function(t){t.BOTTOM="bottom",t.LEFT="left",t.RIGHT="right",t.TOP="top"}(i||(i={})),function(t){t.INPUT="input",t.OUTPUT="output"}(u||(u={})),function(t){t.BLOCK="block",t.BOX="box",t.CARD="card",t.PORT="port"}(c||(c={})),function(t){t.BLUE="blue",t.YELLOW="yellow"}(l||(l={}));var j=n(10975);let w;var x=n(11611),E=n(28160),D=n(28598);function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){(0,f.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var A={cursor:"move",padding:0},k=(0,v.memo)((function(t){var e=t.backgroundColor,n=t.preview,r=t.title;return(0,D.jsx)(x.Z,{alignItems:"center",role:n?"BoxPreview":"Box",style:T(T({},A),{},{backgroundColor:e}),children:(0,D.jsx)(E.Z,{monospace:!0,small:!0,children:r})})}));function R(t,e){return[t,e].join(":")}function I(t){var e,n=t.id,r=[t.type,n];if(c.PORT===t.type){var o=t,i=o.index,u=o.subtype;r.push.apply(r,[u,i])}return null==r||null===(e=r.filter((function(t){return t})))||void 0===e?void 0:e.join("-")}var _=(0,v.memo)((function(t){var e=t.item,n=t.itemRef,o=t.handleOnDrop,i=t.handleMouseDown,u=t.handleMouseUp,l=t.onDragStart,a=t.onMount,f=I(e),d=(0,v.useRef)(0),m=(0,j.c)((function(){return{canDrag:function(t){var r;return l(p()(e,{rect:{$set:null==n||null===(r=n.current)||void 0===r?void 0:r.getBoundingClientRect()}}),t),!0},collect:function(t){var e=t.isDragging();return{backgroundColor:e?"red":"white",isDragging:e,opacity:e?.4:1}},isDragging:function(t){return t.getItem().id===e.id},item:e,type:e.type}}),[e,l]),h=(0,s.Z)(m,3),y=h[0],b=(y.backgroundColor,y.isDragging,h[1]),O=(h[2],(0,g.L)((function(){return{accept:[c.BLOCK,c.PORT],canDrop:function(t,e){return!0},collect:function(t){return{canDrop:t.canDrop(),isOver:t.isOver()}},drop:function(t,r){var i,u=null==n||null===(i=n.current)||void 0===i?void 0:i.getBoundingClientRect(),c=u.left,l=u.height,a=u.top,s=u.width;o(t,p()(e,{rect:{$set:{height:l,left:c,top:a,width:s}}}))}}}),[o,e])),w=(0,s.Z)(O,2),x=w[0],E=x.canDrop,P=x.isOver,T=w[1];return(0,v.useEffect)((function(){n.current&&(0===d.current&&(b(n),T(n),a&&(null==a||a(e,n))),d.current+=1)}),[e,a]),(0,D.jsx)("div",{onDragEnd:u,onMouseDown:i,onMouseUp:u,onTouchStart:function(t){return t.stopPropagation()},style:{border:"1px dotted black",padding:12},children:(0,D.jsx)("div",{ref:n,role:[r.DRAGGABLE,r.DROPPABLE].join(" "),style:{backgroundColor:P&&E?"red":"green",cursor:"move",display:"inline-block",height:24,width:24}})},f)}));function C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?C(Object(n),!0).forEach((function(e){(0,f.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function M(t,e){var n=t.rect,r=e.canDrop,o=e.isDragging,i=e.isOverCurrent,u=n||{},c=u.left,l=u.top,a="translate3d(".concat(c,"px, ").concat(l,"px, 0)"),s="rgba(0, 0, 0, 0.1)";return{WebkitTransform:a,backgroundColor:r&&i?"blue":s,border:"1px dashed gray",height:o?0:200,opacity:o?0:1,position:"absolute",transform:a,width:300}}var S=(0,v.memo)((function(t){var e=t.canDrag,n=t.item,i=t.layout,l=t.onDragStart,a=t.onDrop,f=t.onMouseDown,d=t.onMouseUp,p=t.onPortMount,m=(0,v.useRef)(0),h=(0,v.useRef)({}),y=(0,v.useRef)(null),b=(0,v.useMemo)((function(){return((null==n?void 0:n.inputs)||[]).concat((null==n?void 0:n.outputs)||[])}),[n]),O=(0,v.useState)(null),E=O[0],P=O[1],T=(0,v.useMemo)((function(){return E||n}),[E,n]);(0,v.useEffect)((function(){0===m.current&&G((w||(w=new Image,w.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),w),{captureDraggingState:!0}),m.current+=1}),[]);var A=(0,v.useCallback)((function(t,e){a(t,e)}),[a]),R=(0,j.c)((function(){return{canDrag:function(t){return!(e&&!e(n))&&(l(n,t),!0)},collect:function(t){var e=t.isDragging();return{backgroundColor:e?"red":void 0,isDragging:e,opacity:e?.4:1}},isDragging:function(t){return t.getItem().id===T.id},item:T,type:T.type}}),[T,l]),C=(0,s.Z)(R,3),S=C[0],$=S.backgroundColor,Z=S.isDragging,B=C[1],G=C[2],U=(0,g.L)((function(){return{accept:[c.PORT],canDrop:function(t,e){return!!e.isOver({shallow:!0})&&(c.BLOCK===t.type?t.id!==n.id:c.PORT===t.type&&t.parent.id!==n.id)},collect:function(t){return{canDrop:t.canDrop(),isOverCurrent:t.isOver({shallow:!0})}},drop:function(t,e){A(t,n)}}}),[A,n]),N=(0,s.Z)(U,2),H=N[0],Y=H.canDrop,X=H.isOverCurrent,q=N[1],W=(0,v.useCallback)((function(t,e){console.log("DraggableBlock.handleMouseDown",t),f(t,e),P(e)}),[f]),z=(0,v.useCallback)((function(t,e){d(t,e),P(null)}),[d]),K=(0,v.useCallback)((function(t){return(0,D.jsx)(D.Fragment,{children:null==b?void 0:b.reduce((function(e,n){var r,o;if((null==n?void 0:n.subtype)!==t)return e;var i=I(n),u=null!==(r=null==h||null===(o=h.current)||void 0===o?void 0:o[i])&&void 0!==r?r:(0,v.createRef)();return h.current[i]=u,e.concat((0,D.jsx)(_,{handleMouseDown:function(t){return W(t,n)},handleMouseUp:function(t){return z(t,n)},handleOnDrop:A,item:n,itemRef:u,onDragStart:l,onMount:p},i))}),[])})}),[W,A,z,l,p,b]),F=(0,v.useMemo)((function(){return(null==E?void 0:E.type)===(null==n?void 0:n.type)}),[E,n]);q(y),F&&B(y);var Q=(0,v.useMemo)((function(){return o.VERTICAL===(null==i?void 0:i.direction)}),[i]),V=(0,v.useMemo)((function(){return{alignItems:"center",autoColumns:Q?"auto":null,autoRows:Q?null:"auto",columnGap:Q?12:null,height:"inherit",rowGap:Q?null:12,templateColumns:Q?"auto":"auto 1fr auto",templateRows:Q?"auto 1fr auto":"auto"}}),[Q]),J=(0,v.useMemo)((function(){return{columnGap:Q?12:null,rowGap:Q?null:12,style:{gridTemplateColumns:Q?"repeat(auto-fit, minmax(0px, min-content))":"auto",gridTemplateRows:Q?"auto":"repeat(auto-fit, minmax(0px, min-content))"}}}),[Q]);return(0,D.jsxs)("div",{onDragEnd:function(t){return z(t,n)},onDragStart:function(t){return W(t,n)},onMouseDown:function(t){return W(t,n)},onMouseUp:function(t){return z(t,n)},ref:y,role:[r.DRAGGABLE].join(" "),style:M(n,{canDrop:Y,isDragging:Z&&(null==E?void 0:E.type)===(null==n?void 0:n.type),isOverCurrent:X}),children:[!1,(0,D.jsxs)(x.Z,L(L({},V),{},{children:[(0,D.jsx)(x.Z,L(L({},J),{},{children:K(u.INPUT)})),(0,D.jsx)(k,{backgroundColor:$,preview:F,title:null==n?void 0:n.title}),(0,D.jsx)(x.Z,L(L({},J),{},{children:K(u.OUTPUT)}))]}))]})})),$=n(42972),Z=n(77655);var B={display:"inline-block",transform:"rotate(-7deg)",WebkitTransform:"rotate(-7deg)"},G=(0,v.memo)((function(t){var e=t.title,n=(0,v.useState)(!1),r=n[0],o=n[1];return(0,v.useEffect)((function(){var t=setInterval((function(){return o(!r)}),500);return function(){return clearInterval(t)}}),[r]),(0,D.jsx)("div",{style:B,children:(0,D.jsx)(k,{backgroundColor:r?"yellow":void 0,preview:!0,title:"".concat(e," BlockDragPreview")})})}));function U(t,e){var n=t.x,r=t.y,o=e||{height:32,width:32},i=o.height,u=o.width;return[Math.floor(n/u)*u,Math.floor(r/i)*i]}var N={height:"100%",left:0,pointerEvents:"none",position:"fixed",top:0,width:"100%",zIndex:100};function H(t,e,n){if(!t||!e)return{display:"none"};var r=e.x,o=e.y;if(n){var i=U({x:r-=t.x,y:o-=t.y}),u=(0,s.Z)(i,2);r=u[0],o=u[1],r+=t.x,o+=t.y}var c="translate(".concat(r,"px, ").concat(o,"px)");return{WebkitTransform:c,transform:c}}var Y=function(t){var e=function(t){const e=(0,Z.N)().getMonitor(),[n,r]=(0,$.r)(e,t);return(0,v.useEffect)((()=>e.subscribeToOffsetChange(r))),(0,v.useEffect)((()=>e.subscribeToStateChange(r))),n}((function(t){return{currentOffset:t.getSourceClientOffset(),initialOffset:t.getInitialSourceClientOffset(),isDragging:t.isDragging(),item:t.getItem(),itemType:t.getItemType()}})),n=e.itemType,r=e.isDragging,o=e.item,i=e.initialOffset,u=e.currentOffset;return r?(0,D.jsx)("div",{style:N,children:(0,D.jsx)("div",{style:H(i,u,t.snapToGrid),children:n===c.BLOCK?(0,D.jsx)(G,{title:o.title}):null})}):null},X=n(81728);function q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function W(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?q(Object(n),!0).forEach((function(e){(0,f.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function z(t,e,n){return W(W({from:t.id.toString(),fromItem:t,to:e.id.toString(),toItem:e},{curveControl:.5,fromPosition:"right",toPosition:"left"}),n)}function K(t){var e=t.from,n=t.to;return"".concat(e,"-").concat(n)}function F(t,e){var n=t.left,r=t.height,o=t.top,i=t.width;switch(e){case"top":return{x:n+i/2,y:o};case"bottom":return{x:n+i/2,y:o+r};case"left":return{x:n,y:o+r/2};case"right":return{x:n+i,y:o+r/2};default:return{x:n+i/2,y:o+r/2}}}function Q(t,e,n){var r=function(t,e,n){var r,o=F(e,t.fromPosition),i=F(n,t.toPosition),u=o.x,c=o.y,l=i.x,a=i.y,s=null!==(r=t.curveControl)&&void 0!==r?r:.5;return{endX:l,endY:a,startX:u,startY:c,x1:u+(l-u)*s,x2:l-(l-u)*s,y1:c,y2:a}}(t,e,n),o=r.endX,i=r.endY,u=r.startX,c=r.startY,l=r.x1,a=r.x2,s=r.y1,f=r.y2;return"M".concat(u,",").concat(c," C").concat(l,",").concat(s," ").concat(a,",").concat(f," ").concat(o,",").concat(i)}function V(t,e,n){var r=(n||{}).onlyUpdateTypes,o=t.id,i=t.type,u=function(t,e){return Object.values(e||{}).reduce((function(e,n){var r,o,i,u,c=t.id,l=t.type,a=n.fromItem,s=n.toItem;return a.type===l&&a.id===c||s.type===l&&s.id===c||(null==a||null===(r=a.parent)||void 0===r?void 0:r.type)===l&&(null==a||null===(o=a.parent)||void 0===o?void 0:o.id)===c||(null==s||null===(i=s.parent)||void 0===i?void 0:i.type)===l&&(null==s||null===(u=s.parent)||void 0===u?void 0:u.id)===c?e.concat(n):e}),[])}(t,e.current);null==u||u.forEach((function(n){var u,c,l,a,s,f,d,v,g,m,h,y=K(n),b=n.fromItem,O=n.toItem,j=b.type===i&&b.id===o,w=O.type===i&&O.id===o,x=(null==b||null===(u=b.parent)||void 0===u?void 0:u.type)===i&&(null==b||null===(c=b.parent)||void 0===c?void 0:c.id)===o,E=(null==O||null===(l=O.parent)||void 0===l?void 0:l.type)===i&&(null==O||null===(a=O.parent)||void 0===a?void 0:a.id)===o;if(!r||!(null!=r&&r.fromItem&&(null==r||null===(s=r.fromItem)||void 0===s?void 0:s.type)!==(null==b?void 0:b.type)||null!=r&&r.toItem&&(null==r||null===(f=r.toItem)||void 0===f?void 0:f.type)!==(null==O?void 0:O.type)||null!=r&&r.connection&&(null==r||null===(d=r.connection)||void 0===d?void 0:d.uuid)!==y)){var D,P=null;if(j||x)if(x){if(null!=n&&null!==(D=n.fromItem)&&void 0!==D&&D.rect){var T=n.fromItem.rect.left-n.fromItem.parent.rect.left,A=n.fromItem.rect.top-n.fromItem.parent.rect.top;P=p()(n,{fromItem:{parent:{rect:{$merge:t.rect}},rect:{left:{$set:t.rect.left+T},top:{$set:t.rect.top+A}}}})}}else P=p()(n,{fromItem:{$merge:t}});else if(w||E){var k;if(E){if(null!=n&&null!==(k=n.toItem)&&void 0!==k&&k.rect){var R=n.toItem.rect.left-n.toItem.parent.rect.left,I=n.toItem.rect.top-n.toItem.parent.rect.top;P=p()(n,{toItem:{parent:{rect:{$merge:t.rect}},rect:{left:{$set:t.rect.left+R},top:{$set:t.rect.top+I}}}})}}else P=p()(n,{toItem:{$merge:t}})}if(P&&null!==(v=P)&&void 0!==v&&null!==(g=v.fromItem)&&void 0!==g&&g.rect&&null!==(m=P)&&void 0!==m&&null!==(h=m.toItem)&&void 0!==h&&h.rect){var _=document.getElementById(y);if(_){var C=Q(P,P.fromItem.rect,P.toItem.rect);_.setAttribute("d",C),e.current[y]=P}}}}))}var J=(0,v.memo)((function(t){var e,n,r=t.connection,o=null==r||null===(e=r.fromItem)||void 0===e?void 0:e.rect,i=null==r||null===(n=r.toItem)||void 0===n?void 0:n.rect,u="".concat(K(r)),c="";return o&i&&(c=Q(r,o,i)),(0,D.jsx)("path",{d:c,fill:"transparent",id:u,stroke:"black",strokeWidth:"2"},K(r))})),tt=function(t){var e=t.children;return(0,D.jsx)("svg",{style:{height:"100%",left:0,pointerEvents:"none",position:"absolute",top:0,width:"100%"},children:e})};function et(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function nt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?et(Object(n),!0).forEach((function(e){(0,f.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function rt(t,e){var n=e.getClientOffset(),r=e.getInitialClientOffset();if(!n||!r)return t;var o=e.getClientOffset(),i=o.x-r.x,u=o.y-r.y;return nt(nt({},t),{},{left:Math.round(t.left+i),top:Math.round(t.top+u)})}var ot=n(21831);var it=function(t,e){var n,r,o;return null!==(n=null==t||null===(r=t.closest("[role]"))||void 0===r||null===(o=r.getAttribute("role"))||void 0===o?void 0:o.split(" ").includes(e))&&void 0!==n&&n},ut=function(t,e){var n=e.disabled,r=void 0!==n&&n,o=e.zoomSensitivity,i=void 0===o?.5:o,u=e.minScale,c=void 0===u?.01:u,l=e.maxScale,a=void 0===l?4:l,s=e.roles,f=(0,v.useRef)(1),d=(0,v.useRef)(0),p=(0,v.useRef)(0),g=(0,v.useRef)(0),m=(0,v.useRef)(0),h=(0,v.useRef)(!1);(0,v.useEffect)((function(){var e=t.current;if(e){var n=function(){console.log("ZoomPan transforming..."),e.style.transform="translate(".concat(d.current,"px, ").concat(p.current,"px) scale(").concat(f.current,")")},o=function(t){if(!(r||null!=s&&s.some((function(e){return it(t.target,e)})))){t.preventDefault();var o=-t.deltaY/500*i,u=f.current;f.current=Math.min(Math.max(c,f.current+o),a);var l=f.current/u,v=e.getBoundingClientRect(),g=t.clientX-v.left,m=t.clientY-v.top;d.current-=(g-d.current)*(l-1),p.current-=(m-p.current)*(l-1),n()}},u=function(t){r||null!=s&&s.some((function(e){return it(t.target,e)}))||0===t.button&&(t.preventDefault(),g.current=t.clientX-d.current,m.current=t.clientY-p.current,h.current=!0)},l=function(t){r||null!=s&&s.some((function(e){return it(t.target,e)}))||h.current&&(d.current=t.clientX-g.current,p.current=t.clientY-m.current,n())},v=function(){h.current=!1},y=function(t){if(!(r||null!=s&&s.some((function(e){return it(t.target,e)})))&&1===t.touches.length){var e=t.touches[0];g.current=e.clientX-d.current,m.current=e.clientY-p.current,h.current=!0}},b=function(t){if(!(r||null!=s&&s.some((function(e){return it(t.target,e)})))&&h.current&&1===t.touches.length){var e=t.touches[0];d.current=e.clientX-g.current,p.current=e.clientY-m.current,n()}},O=function(){h.current=!1};return e.addEventListener("wheel",o),e.addEventListener("mousedown",u),e.addEventListener("mousemove",l),window.addEventListener("mouseup",v),e.addEventListener("touchstart",y),e.addEventListener("touchmove",b),e.addEventListener("touchend",O),function(){e.removeEventListener("wheel",o),e.removeEventListener("mousedown",u),e.removeEventListener("mousemove",l),window.removeEventListener("mouseup",v),e.removeEventListener("touchstart",y),e.removeEventListener("touchmove",b),e.removeEventListener("touchend",O)}}}),[t,r,i,c,a,s])},ct=["snapToGridOnDrop"];function lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function at(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?lt(Object(n),!0).forEach((function(e){(0,f.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var st=function(t){var e=t.blocks,n=t.canvasRef,r=t.onDragEnd,l=t.onDragStart,a=t.snapToGridOnDrag,d=void 0===a||a;console.log("PipelineBuilder render");var m=(0,v.useMemo)((function(){return{direction:o.VERTICAL,origin:i.TOP}}),[]),h=(0,v.useRef)(0),y=(0,v.useRef)(null),b=(0,v.useRef)(null),O=(0,v.useRef)(null),j=(0,v.useRef)(null),w=(0,v.useRef)(null),x=(0,v.useState)(null),E=x[0],P=x[1],T=(0,v.useState)(null),A=T[0],k=T[1],_=(0,v.useState)(null),C=_[0],L=_[1];function M(t){y.current=at(at({},y.current),t),P(y.current)}function $(t){j.current=t,k(t)}function Z(t){O.current=t,L((function(e){return at(at({},e),t)})),M(y.current)}function B(t){c.BLOCK===t.type?V(t,y):c.PORT===t.type&&V(t,j)}function G(t,e){l()}function N(t,e){r(),q()}function H(t,e){if(console.log("onDragStart",null==t?void 0:t.type),!w.current&&c.PORT===t.type){var n=e.getInitialClientOffset(),r=n.x,o=n.y,i=p()(t,{rect:{$set:{height:t.rect.height,left:r,top:o,width:t.rect.width}}});w.current=i;var u=z(i,p()(i,{id:{$set:(0,X.Lo)()}}));$((0,f.Z)({},K(u),u))}}function Y(t,e){console.log("onDragging",null==t?void 0:t.type);var n,r=null==t?void 0:t.rect;c.PORT===t.type&&w.current&&I(t)===I(null==w?void 0:w.current)&&(r=null==w||null===(n=w.current)||void 0===n?void 0:n.rect);B(p()(t,{rect:{$set:rt(r,e)}}))}function q(){w.current=null,$(null)}function W(t,e){var n,r;q();var o=e.getDifferenceFromInitialOffset(),i=Math.round((null==t||null===(n=t.rect)||void 0===n?void 0:n.left)+o.x),u=Math.round((null==t||null===(r=t.rect)||void 0===r?void 0:r.top)+o.y);if(d){var c=U({x:i,y:u},{height:100,width:100}),l=(0,s.Z)(c,2);i=l[0],u=l[1]}var a=p()(t,{rect:{$merge:{left:i,top:u}}});console.log("onDrop",a),function(t){Z((0,f.Z)({},t.id,t)),B(t)}(a)}(0,v.useEffect)((function(){if(0===h.current&&(null==e?void 0:e.length)>=1){var t=function(t,e){var n=e||{},r=n.blockHeight,l=void 0===r?200:r,a=n.blockWidth,d=void 0===a?300:a,v=n.horizontalSpacing,g=void 0===v?200:v,m=n.layout,h=(n.maxHeight,n.maxWidth,n.verticalSpacing),y=void 0===h?100:h,b=m||{},O=(void 0===(void 0===b.direction&&o.HORIZONTAL,b.origin)&&i.LEFT,{}),j={},w={},x={},E={},D=new Set,P=0;t.forEach((function e(n){return void 0!==E[n.uuid]||(0===n.upstream_blocks.length?E[n.uuid]=0:E[n.uuid]=Math.max.apply(Math,(0,ot.Z)(n.upstream_blocks.map((function(n){var r=t.find((function(t){return t.uuid===n}));return r?e(r)+1:0})))),P=Math.max(P,E[n.uuid])),E[n.uuid]}));for(var T={},A=0;A<=P;A++)T[A]=[20];function k(t,e){var n=t*(l+y)+20;return{left:e?e.left+d+g:T[t][T[t].length-1]+d+g,top:n}}return t.forEach((function(t){var e,n=E[t.uuid],r=n*(l+y)+20;e=t.upstream_blocks.length>0?k(n,x[t.upstream_blocks[0]]).left:k(n).left,x[t.uuid]={left:e,top:r},D.add("".concat(e,",").concat(r)),T[n].push(e)})),t.forEach((function(t){var e=x[t.uuid];O[t.uuid]={id:t.uuid,rect:{height:l,left:e.left,top:e.top,width:d},title:t.name,type:c.BLOCK}})),null==t||t.forEach((function(t){var e,n=O[null==t?void 0:t.uuid],r=[],o=[];Object.entries((e={},(0,f.Z)(e,u.INPUT,t.upstream_blocks),(0,f.Z)(e,u.OUTPUT,t.downstream_blocks),e)).forEach((function(e){var i=(0,s.Z)(e,2),l=i[0],a=i[1];null==a||a.forEach((function(e,i){var a={id:R(null==t?void 0:t.uuid,e),index:i,parent:n,subtype:l,type:c.PORT};w[I(a)]=a,u.INPUT===(null==a?void 0:a.subtype)?r.push(a):u.OUTPUT===(null==a?void 0:a.subtype)&&o.push(a)}))})),O[t.uuid]=p()(n,{inputs:{$set:r},outputs:{$set:o}})})),t.forEach((function(t){var e,n=O[t.uuid];null==t||null===(e=t.downstream_blocks)||void 0===e||e.forEach((function(e){var r,o,i=O[e],u=null==n||null===(r=n.outputs)||void 0===r?void 0:r.find((function(n){return n.id===R(null==t?void 0:t.uuid,e)})),c=null==i||null===(o=i.inputs)||void 0===o?void 0:o.find((function(n){return n.id===R(e,t.uuid)}));if(u&&c){var l=z(u,c);l&&(j[K(l)]=l)}}))})),{connectionsMapping:j,itemsMapping:O,portsMapping:w}}(e,{blockHeight:200,blockWidth:300,layout:m,maxHeight:window.innerHeight}),n=t.connectionsMapping,r=t.itemsMapping,l=t.portsMapping;y.current=n,b.current=l,Z(r)}return h.current+=1,function(){h.current=0,y.current=null,b.current=null,O.current=null,j.current=null,w.current=null}}),[e,m]);var F=(0,v.useCallback)((function(t,e){if(c.PORT===t.type&&c.PORT===e.type){var n,r,o=w.current,i=z(p()(o,{parent:{$set:null==C?void 0:C[null==o||null===(n=o.parent)||void 0===n?void 0:n.id]}}),p()(e,{parent:{$set:null==C?void 0:C[null==e||null===(r=e.parent)||void 0===r?void 0:r.id]}}));M((0,f.Z)({},K(i),i)),console.log("onDropNode",i)}q()}),[C]);function Q(t,e){if(e.current){var n,r=e.current.getBoundingClientRect(),o=p()(t,{rect:{$set:{height:r.height,left:r.left,top:r.top,width:r.width}}});b.current=p()(b.current,(0,f.Z)({},I(o),{$set:o}));var i=null===(n=Object.values((null==y?void 0:y.current)||{}))||void 0===n?void 0:n.every((function(t){var e=t.fromItem,n=t.toItem;if(!e||!n||c.PORT!==(null==e?void 0:e.type)&&c.PORT!==(null==n?void 0:n.type))return!0;var r=[e,n].every((function(t){var e,n=I(t),r=null==b||null===(e=b.current)||void 0===e?void 0:e[n];return r&&["left","height","top","width"].every((function(t){var e,n;return null!==(e=null==r||null===(n=r.rect)||void 0===n?void 0:n[t])&&void 0!==e&&e}))}));if(r){var o,i,u=p()(t,{fromItem:{$set:null==b||null===(o=b.current)||void 0===o?void 0:o[I(e)]},toItem:{$set:null==b||null===(i=b.current)||void 0===i?void 0:i[I(n)]}});y.current=p()(y.current,(0,f.Z)({},K(u),{$set:u}))}return r}));i&&Object.values((null==O?void 0:O.current)||{}).forEach((function(t){V(t,y)}))}}var et=(0,g.L)((function(){return{accept:[c.BLOCK,c.PORT],canDrop:function(t,e){return!!e.isOver({shallow:!0})&&c.BLOCK===t.type},drop:function(t,e){W(t,e)},hover:Y}}),[]);return(0,(0,s.Z)(et,2)[1])(n),(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(tt,{children:[E&&Object.values(E||{}).map((function(t){return(0,D.jsx)(J,{connection:t},K(t))})),A&&Object.values(A||{}).map((function(t){return(0,D.jsx)(J,{connection:t},K(t))}))]}),h.current>=1&&C&&Object.keys(C||C).map((function(t){return(0,D.jsx)(S,{item:C[t],layout:m,onDragStart:H,onDrop:F,onMouseDown:G,onMouseUp:N,onPortMount:Q},t)}))]})};function ft(t){var e=t.snapToGridOnDrop,n=void 0!==e&&e,o=(0,a.Z)(t,ct),i=(0,v.useRef)(null),u=(0,v.useState)(!1),c=u[0],l=u[1];return console.log("ZoomPan disabled:",c),ut(i,{disabled:c,roles:[r.DRAGGABLE]}),(0,v.useEffect)((function(){var t=function(t){var e=t.target;[r.DRAGGABLE].some((function(t){return e.closest('[role="'.concat(t,'"]'))}))?(l(!0),console.log("Handle role")):console.log("Handle ZoomPan")},e=function(t){var e=t.target;[r.DRAGGABLE,r.DROPPABLE].some((function(t){return e.closest('[role="'.concat(t,'"]'))}))?(l(!1),console.log("Handle role")):console.log("Handle ZoomPan")},n=i.current;return n&&(n.addEventListener("mousedown",t),n.addEventListener("mouseup",e)),function(){n&&(n.removeEventListener("mousedown",t),n.removeEventListener("mouseup",e))}}),[]),(0,D.jsx)("div",{onDoubleClick:function(t){console.log("Add block...")},ref:i,style:{height:"100vh",width:"100vw",position:"relative",overflow:"visible"},children:(0,D.jsx)(O,{children:(0,D.jsxs)(m.W,{backend:h.PD,children:[(0,D.jsx)(Y,{snapToGrid:n}),(0,D.jsx)(st,at(at({},o),{},{canvasRef:i,onDragEnd:function(){return l(!1)},onDragStart:function(){return l(!0)}}))]})})})}},28160:function(t,e,n){"use strict";var r=n(82394),o=n(21831),i=n(75582),u=n(26304),c=(n(82684),n(77772)),l=n.n(c),a=n(54587),s=n(81728),f=n(28598),d=["children","className","inline","small","xsmall"];function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?p(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}e.Z=function(t){var e=t.children,n=t.className,r=t.inline,c=t.small,p=t.xsmall,g=(0,u.Z)(t,d),m=[c?l().small:p?l().xsmall:l().text,n||""];Object.entries(g||{}).forEach((function(t){var e=(0,i.Z)(t,2),n=e[0],r=e[1];if(void 0!==r&&!1!==r){var u,c,a,f=null===(u=[(0,s.JA)(n)].concat((0,o.Z)(null===(c=String("boolean"==typeof r?"":r))||void 0===c||null===(a=c.replace("%",""))||void 0===a?void 0:a.split(" "))).filter((function(t){return(null==t?void 0:t.length)>=1})))||void 0===u?void 0:u.join("-"),d=l()[f];m.push(d)}}));var h=m.filter((function(t){var e;return null!=t&&(null===(e=String(t))||void 0===e?void 0:e.length)>=1})).join(" ");return r?(0,f.jsx)("span",v(v({},(0,a.y)(g)),{},{className:h,children:e})):(0,f.jsx)("p",v(v({},(0,a.y)(g)),{},{className:h,children:e}))}},77772:function(t){t.exports={text:"Text_text__uz5r4",inverted:"Text_inverted__32PC6",blue:"Text_blue___EUOq",muted:"Text_muted__JRwai",warning:"Text_warning___E0Ea",italic:"Text_italic__SOXdC",light:"Text_light__Dcwkw",medium:"Text_medium__hSWiP",semiBold:"Text_semiBold__nZ0gz",bold:"Text_bold__0SalO",black:"Text_black___x9WX",small:"Text_small__zGqaM",xsmall:"Text_xsmall__tdzOm",monospace:"Text_monospace__xbT6D"}},91560:function(t){t.exports={canvas:"Builder_canvas__QOQZq"}}}]);