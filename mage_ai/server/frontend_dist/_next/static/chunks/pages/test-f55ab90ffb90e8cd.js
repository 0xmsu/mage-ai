(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5378],{16488:function(n,e,t){"use strict";t.d(e,{IJ:function(){return m},M8:function(){return I},Uc:function(){return T},XM:function(){return S},_U:function(){return p},eI:function(){return h},gU:function(){return O},lO:function(){return Z},ri:function(){return g},tL:function(){return N},vJ:function(){return b},xH:function(){return E}});var r,u=t(82394),i=t(92083),o=t.n(i),c=t(3917),l=t(4383),a=t(30229),s=t(42122),f=t(86735);function d(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function v(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?d(Object(t),!0).forEach((function(e){(0,u.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var p=function(n){return!!n&&!Object.values(a.U5).includes(n)};function m(n){return null==n?void 0:n.reduce((function(n,e){var t=e.block_uuid,r=e.completed_at,i=e.started_at,c=e.status,l=null;i&&r&&(l=o()(r).valueOf()-o()(i).valueOf());return v(v({},n),{},(0,u.Z)({},t,{runtime:l,status:c}))}),{})}var _,g=function(n){var e=[{description:function(){return"This pipeline will run continuously on an interval or just once."},label:function(){return"Schedule"},uuid:a.Xm.TIME},{description:function(){return"This pipeline will run when a specific event occurs."},label:function(){return"Event"},uuid:a.Xm.EVENT},{description:function(){return"Run this pipeline when you make an API call."},label:function(){return"API"},uuid:a.Xm.API}];return n?e.slice(0,1):e};function E(n){var e=(0,s.gR)(n,[a.gm.INTERVAL,a.gm.TYPE]),t=n[a.gm.INTERVAL];t&&(e["schedule_interval[]"]=encodeURIComponent(t));var r=n[a.gm.TYPE];return r&&(e["schedule_type[]"]=r),e}function h(n){return n?new Date(o()(n).valueOf()):null}function T(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e?(0,c.XG)(n,e,t):function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"!=typeof n)return n;var t=n.split("+")[0];return o()(h(t)).format(e||c.Nx)}(n,t)}!function(n){n.DAY="day",n.HOUR="hour",n.MINUTE="minute",n.SECOND="second"}(_||(_={}));var N=(r={},(0,u.Z)(r,_.DAY,86400),(0,u.Z)(r,_.HOUR,3600),(0,u.Z)(r,_.MINUTE,60),(0,u.Z)(r,_.SECOND,1),r);function O(n){var e=_.SECOND,t=n;return n%86400==0?(t/=86400,e=_.DAY):n%3600==0?(t/=3600,e=_.HOUR):n%60==0&&(t/=60,e=_.MINUTE),{time:t,unit:e}}function b(n,e){return n*N[e]}function S(n,e,t){var r,u=o()(n);return u.set("hour",+(null==e?void 0:e.hour)||0),u.set("minute",+(null==e?void 0:e.minute)||0),u.set("second",0),r=u.format(c.TD),null!=t&&t.includeSeconds&&(r=r.concat(":00")),null!=t&&t.localTimezone&&(r=u.format(c.lE),null!=t&&t.convertToUtc&&(r=(0,c.d$)(r,{includeSeconds:null==t?void 0:t.includeSeconds,utcFormat:!0}))),r}function I(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="",r=(0,l.XF)();return e?t="".concat(r,"/api/pipeline_schedules/").concat(null==n?void 0:n.id,"/api_trigger"):(t="".concat(r,"/api/pipeline_schedules/").concat(null==n?void 0:n.id,"/pipeline_runs"),null!=n&&n.token&&(t="".concat(t,"/").concat(n.token))),t}function C(n,e,t){return n.match(/[*,-/]/)?{additionalOffset:0,cronValue:n}:function(n,e,t){var r=t.indexOf(n),u=0;if(e<0)for(var i=0;i>e;i--)0===r?(r=t.length-1,u-=1):r-=1;else if(e>0)for(var o=0;o<e;o++)r===t.length-1?(r=0,u+=1):r+=1;var c="number"==typeof t[r]?t[r]:n;return{additionalOffset:u,cronValue:String(c)}}(+n,e,t)}var P=(0,f.m5)(60),y=(0,f.m5)(24),A=(0,c.Cs)();function Z(n,e){if(!n)return n;var t=o()().local().format("Z"),r=t.split(":"),u="-"===t[0],i=3===r[0].length?Number(r[0].slice(1)):Number(r[0]),c=Number(r[1]);(u&&!e||!u&&e)&&(i=-i,c=-c);var l=n.split(" "),a=l[0],s=l[1],f=l[2],d=C(a,c,P),v=C(s,i+d.additionalOffset,y);if(l[0]=d.cronValue,l[1]=v.cronValue,0!==(null==v?void 0:v.additionalOffset)){var p=C(f,v.additionalOffset,A);l[2]=p.cronValue}return l.join(" ")}},70320:function(n,e,t){"use strict";t.d(e,{EB:function(){return o},hY:function(){return l},qB:function(){return c}});var r=t(72191),u=t(78419),i=t(53808),o={block:!0,description:"Display dates in local timezone. Please note that certain pages (e.g. Monitor page) or components (e.g. Pipeline run bar charts) may still be in UTC time. Dates in local time will have a timezone offset in the timestamp (e.g. -07:00).",lightBackground:!0,muted:!0,size:r._k};function c(){return(0,i.U2)(u.am,null)||!1}function l(n){return void 0!==n&&(0,i.t8)(u.am,n),n}},30229:function(n,e,t){"use strict";t.d(e,{PN:function(){return c},TR:function(){return p},U5:function(){return a},Wb:function(){return v},Xm:function(){return i},Z4:function(){return s},fq:function(){return l},gm:function(){return f},kJ:function(){return d}});var r,u,i,o=t(82394),c="__bookmark_values__";!function(n){n.API="api",n.EVENT="event",n.TIME="time"}(i||(i={}));var l,a,s=(r={},(0,o.Z)(r,i.API,(function(){return"API"})),(0,o.Z)(r,i.EVENT,(function(){return"event"})),(0,o.Z)(r,i.TIME,(function(){return"schedule"})),r);!function(n){n.ACTIVE="active",n.INACTIVE="inactive"}(l||(l={})),function(n){n.ONCE="@once",n.HOURLY="@hourly",n.DAILY="@daily",n.WEEKLY="@weekly",n.MONTHLY="@monthly",n.ALWAYS_ON="@always_on"}(a||(a={}));var f,d,v=[a.ONCE,a.HOURLY,a.DAILY,a.WEEKLY,a.MONTHLY];!function(n){n.INTERVAL="frequency[]",n.STATUS="status[]",n.TAG="tag[]",n.TYPE="type[]"}(f||(f={})),function(n){n.CREATED_AT="created_at",n.NAME="name",n.PIPELINE="pipeline_uuid",n.STATUS="status",n.TYPE="schedule_type"}(d||(d={}));var p=(u={},(0,o.Z)(u,d.CREATED_AT,"Created at"),(0,o.Z)(u,d.NAME,"Name"),(0,o.Z)(u,d.PIPELINE,"Pipeline"),(0,o.Z)(u,d.STATUS,"Active"),(0,o.Z)(u,d.TYPE,"Type"),u)},72191:function(n,e,t){"use strict";t.d(e,{_k:function(){return o},bL:function(){return i},gt:function(){return u},l2:function(){return c},nz:function(){return l}});var r=t(70515),u=1.5*r.iI,i=2*r.iI,o=2.5*r.iI,c=3*r.iI,l=3.5*r.iI},70515:function(n,e,t){"use strict";t.d(e,{Fo:function(){return o},Gg:function(){return f},HN:function(){return p},Mq:function(){return v},Vj:function(){return i},cd:function(){return l},iI:function(){return r},l4:function(){return s},rV:function(){return d},ro:function(){return c},tr:function(){return u},zC:function(){return a}});var r=8,u=2*r,i=5*r,o=10,c=8.7,l=2,a=l,s=r*l,f=l,d=r*l,v=3,p=5},51697:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return M}});var r,u,i,o,c,l=t(77837),a=t(38860),s=t.n(a),f=t(89565),d=t.n(f),v=t(82684),p=t(38276),m=t(55485),_=t(97618),g=t(2367),E=t(21831),h=t(75582),T=t(83455),N=t(5332);!function(n){n[n.CONNECTING=0]="CONNECTING",n[n.OPEN=1]="OPEN",n[n.CLOSED=2]="CLOSED"}(r||(r={})),function(n){n.DATA="data",n.STDOUT="stdout"}(u||(u={})),function(n){n.EXECUTION="execution",n.EXECUTION_STATUS="execution_status",n.TASK="task",n.TASK_STATUS="task_status"}(i||(i={})),function(n){n.ERROR="error",n.FAILURE="failure",n.RUNNING="running",n.SUCCESS="success"}(o||(o={})),function(n){n.CLOSED="closed",n.CONNECTING="connecting",n.OPEN="open",n.RECONNECTING="reconnecting"}(c||(c={}));var O=t(4383),b=t(72619),S=t(87432),I=t(81728);function C(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{autoReconnect:!0,maxConnectionAttempts:10},t=e.autoReconnect,u=e.maxConnectionAttempts,i=(0,v.useRef)(u),o=(0,v.useRef)(null),l=(0,v.useRef)(null),a=(0,v.useState)([]),s=a[0],f=a[1],d=(0,v.useState)([]),p=d[0],m=d[1],_=(0,v.useState)([]),g=_[0],C=_[1],P=(0,v.useState)(c.CONNECTING),y=P[0],A=P[1],Z=(0,T.Db)((function(e){return m((function(n){return[].concat((0,E.Z)(n),[null])})),N.ZP.code_executions.useCreate()({code_execution:{message:null==e?void 0:e.message,message_request_uuid:(0,I.Mp)(),timestamp:Number(new Date),uuid:n}})}),{onSuccess:function(n){return(0,b.wD)(n,{callback:function(n){(0,S.L1)()&&console.log("useEventStreams.createMessage",n),null!=n&&n.server_sent_event&&C((function(e){return[].concat((0,E.Z)(e),[null==n?void 0:n.server_sent_event])}))},onErrorCallback:function(n){f((function(e){return[].concat((0,E.Z)(e),[n])}))}})}}),j=(0,h.Z)(Z,2),x=j[0],k=j[1].isLoading;function w(){var n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||(null==o?void 0:o.current);n&&(null==n||n.close()),null!=o&&o.current&&(o.current=null),A(c.CLOSED)}function L(n,e){if(e<=0)console.log("Max reconnection attempts reached. Stopping reconnection.");else{var u=e;null!=o&&o.current&&(r.OPEN===(null==o?void 0:o.current.readyState)?(A(c.OPEN),u=null==i?void 0:i.current,clearTimeout(null==l?void 0:l.current)):w());var a=null==o?void 0:o.current;a||(console.log("Connecting to server..."),o.current=new EventSource((0,O.if)(n)),(a=null==o?void 0:o.current)&&(a.onopen=function(n){(0,S.L1)()&&console.log("useEventStreams.onopen",a,n),A(c.OPEN)},a.onmessage=function(e){(0,S.L1)()&&console.log("useEventStreams.onmessage",e);var t=JSON.parse(e.data);t.uuid===n&&m((function(n){return[].concat((0,E.Z)(n),[t])}))},a.onerror=function(e){console.error("EventSource failed with error: ",e),f((function(n){return[].concat((0,E.Z)(n),[e])})),w(),t&&(A(c.RECONNECTING),clearTimeout(null==l?void 0:l.current),l.current=setTimeout((function(){console.log("Reconnecting to server witth ".concat(u," attempt(s) remaining...")),L(n,u-1)}),1e3*(Math.max(0,(null==i?void 0:i.current)-u)+1)))}))}}return(0,v.useEffect)((function(){L(n,1+(t&&(null==i?void 0:i.current)||0));var e=null==o?void 0:o.current;return function(){w(e)}}),[t,n]),{errors:s,events:p,loading:k,messages:g,recentEvent:null==p?void 0:p[(null==p?void 0:p.length)-1],sendMessage:x,status:y}}var P=t(3917),y=t(92083),A=t.n(y),Z=t(35576),j=t(16488),x=t(70320),k=t(71180),w=t(30160),L=t(28598);function U(n){var e=n.error,t=(0,g.Z)({response:{error:e},stackTraceVisible:!0,tracebackVisible:!0}),r=t.displayMessage,u=t.exception,i=t.links,o=t.stackTrace,c=t.traceback;return(0,L.jsxs)("div",{children:[(0,L.jsx)(w.ZP,{bold:!0,large:!0,children:"Error"}),r&&(0,L.jsx)(p.Z,{mt:1,children:r}),u&&(0,L.jsx)(p.Z,{mt:1,children:u}),c&&(0,L.jsx)(p.Z,{mt:2,children:c}),o&&(0,L.jsx)(p.Z,{mt:2,children:o}),i]})}function D(n){var e=n.uuid,t=(0,x.qB)(),r=(0,v.useState)(""),i=r[0],o=r[1],c=C(e),l=c.errors,a=c.events,s=c.loading,f=c.sendMessage,p=c.status;null!=l&&l.length&&console.log(l);var g=(0,v.useMemo)((function(){var n,e;return null==a||null===(n=a[(null==a?void 0:a.length)-1])||void 0===n||null===(e=n.result)||void 0===e?void 0:e.error}),[a]),E=(0,v.useMemo)((function(){return null==a?void 0:a.filter((function(n){return!!n}))}),[a]),h=(0,v.useMemo)((function(){var n;return(null==E||null===(n=E.filter((function(n){var e;return(null==n||null===(e=n.result)||void 0===e?void 0:e.type)===u.STDOUT})))||void 0===n?void 0:n.length)||0}),[E]);return console.log(a),(0,L.jsxs)("div",{children:[g&&(0,L.jsx)(U,{error:g}),null==E?void 0:E.map((function(n,e){if(!n)return null;var r=n.event_uuid,u=n.result,i=n.timestamp,o=u||{output:null,output_text:null},c=(o.output,o.output_text),l=(0,I.NE)("",String(h).length-String(e).length,"&nbsp;")+"[".concat(e,"]");return(0,L.jsx)("div",{children:(0,L.jsxs)(m.ZP,{alignItems:"flex-start",fullWidth:!0,justifyContent:"space-between",children:[(0,L.jsx)(_.Z,{children:(0,L.jsxs)(w.ZP,{monospace:!0,preWrap:!0,children:[(0,L.jsx)(w.ZP,{default:!0,inline:!0,monospace:!0,children:(0,L.jsx)("span",{dangerouslySetInnerHTML:{__html:l}})})," ",(0,L.jsx)(d(),{children:c})]})}),(0,L.jsx)(w.ZP,{monospace:!0,muted:!0,children:(0,j.Uc)(A()(i).format(P.BL),t,P.BL)})]})},r)})),(0,L.jsx)(Z.Z,{autoGrow:!0,label:"Message",monospace:!0,name:"message",onChange:function(n){return o(n.target.value)},rows:12}),(0,L.jsxs)(k.ZP,{loading:s,onClick:function(){return f({message:i})},children:["Send Message (",p,")"]})]})}D.getInitialProps=function(){var n=(0,l.Z)(s().mark((function n(e){var t;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.query.uuid,n.abrupt("return",{uuid:t});case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();var M=D},78419:function(n,e,t){"use strict";t.d(e,{Ch:function(){return o},H8:function(){return r},MS:function(){return v},Tz:function(){return c},am:function(){return l},dT:function(){return a},g6:function(){return u},iL:function(){return f},kL:function(){return s},ls:function(){return p},qj:function(){return d},vF:function(){return i}});var r="pipeline_edit_before_tab_selected",u="pipeline_edit_hidden_blocks",i="pipeline_edit_block_output_logs",o="setup_ai_later",c="auto_scroll_logs",l="display_local_timezone",a="hide_public_demo_warning",s="include_server_time_seconds",f="pipeline_editor_side_by_side_enabled",d="pipeline_editor_side_by_side_scroll_together",v="hide_block_output_on_execution",p="disable_autosave"},91185:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test",function(){return t(51697)}])}},function(n){n.O(0,[2678,365,184,9518,5946,2655,3745,9565,5332,9895,9774,2888,179],(function(){return e=91185,n(n.s=e);var e}));var e=n.O();_N_E=e}]);